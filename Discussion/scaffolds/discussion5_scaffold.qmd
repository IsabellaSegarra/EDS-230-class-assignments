---
title: "Discussion5_Summarizing Dynamic Model Output"
format: revealjs
theme: solarized
resources: ["img/"]
css: ["slides.css"]
editor: visual
---

## Adding Carrying Capacity

## R code with carrying capacity {.scrollable}

```{r exampleode}
library(deSolve)
library(tidyverse)
library(here)

source(here("R/dexppop_play.R"))

dexppop_play

# create parameter list
initialrabbits = 2
years = seq(from = 1, to = 100, by = 2)

newparms = list(r = 0.03, carry_capacity = 300)

# apply solver
results = ode(initialrabbits, years, dexppop_play, newparms)

# add more meaningful names
colnames(results) <- c('year', 'P')
```

## Plot

```{r, plotodep}
# plot

ggplot(as.data.frame(results), aes(year, P))+
  geom_point() +
  labs(x = "year", y = "Population")

```

## Try again with different parameters {.scrollable}

```{r exampleode2}
# same initial condtions
initalrabbits <- 2
years <- seq(from = 1, to = 100, by = 2)

# try again with different parameters
alternativeparms <- list(r = 0.04, carry_capacity = 500)
results2 <- ode(initalrabbits, years, dexppop_play, alternativeparms)


# look at results
head(results2)
colnames(results2) <- c("year", "P_parm2") # updated parms 

# plot
ggplot(as.data.frame(results2), aes(year, P_parm2)) +
  geom_point() +
  labs(y = "Population", x="years")

# compare by combining into a single data frame
both <- inner_join(as.data.frame(results), as.data.frame(results2))

#both_p <- both %>% gather(key = "model", value = "P", -year)

both_p <- both %>% pivot_longer(-year, names_to = "model", values_to = "P")

```

## Plot

```{r, plotb}
# plot
ggplot(both_p, aes(year, P, col = model)) +
  geom_point() +
  labs(y = "Population", "years", col = "Model")

```

## Extracting information from space-time results {.scrollable}

In class we've talking about summarizing results from dynamic models

-   pictures can be hard to interpret

-   summarizing over one of the dimensions (either space or time) can help

-   looking at a single trajectory through time

-   looking at spatial variation for one point in time

-   looking at spatial variation for multiple points in time

## Extracting from our diffusion model {.scrollable}

```{r}
source(here("R/diffusion.R"))

```

# Summarizing Model Output

-   Summarize relative to what you care about

Lets say this was a pollutant injected into a stream...

-   lets say you have a vulnerable habit located 3 spatial units from the injection point

-   lets see what its pollutant exposure looks like.\

```{r one option}
# View(resfast_fixtime$conc)


# graph a single point in space through time
# single column (time)

```

-   what if we were concerned about all locations

```{r all locations}
# plot all trajectories
# add a time column to concentration data frame and transform for plotting


# plot all places at each point in time

```

# Spatial summaries

-   interested in how quickly the pollutant evens out through space

```{r spatial summaries}

# use apply to calculate the spatial variation for each row (e.g for each time point)

# notice its the same as the number of time units (nt) used above

# plot spatial variation through time


# plot coefficient of variation (so standard deviation divided by the mean)

```

## it is helpful to turn the summary into a function that you can apply to the dynamic models output

## In class exercise {.scrollable}

For population model - write a function that summarizes something about the population over time
